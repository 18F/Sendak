#!/usr/bin/env node

'use strict;'

var plugsuit = require( 'plugsuit' )
	, parsed   = require( 'sendak-usage' ).parsedown( {
			'help'       : { 'type' : [ Boolean ] }
		}, process.argv )
	, usage    = parsed[1]
	, args     = parsed[0];

if (args['help']) {
	console.log( 'Usage:' );
	console.log( usage );
	process.exit( 0 );
}

function get_initdir () { // {{{
	var initdir;
	if (process.env.SENDAK_DIR) {
		initdir = process.env.SENDAK_DIR
	}
	else if (require('fs').existsSync( '/usr/local/lib/node_modules/sendak/bin/js')) {
		initdir = '/usr/local/lib/node_modules/sendak/bin/js';
	}
	else if (require('fs').existsSync( './node_modules/sendak/bin/js' )) {
		initdir = './node_modules/sendak/bin/js';
	}
	return initdir;
} // }}}

if (get_initdir()) {
	plugsuit.init( get_initdir() );
	plugsuit.dispatch( process.argv );
}
else {
	plugsuit.logger.fatal( 'Could not initialise Sendak; try setting SENDAK_DIR?');
}

// @janearc 🐙👾 // jane@cpan.org // vim:tw=80:ts=2:noet
